import{m as f,k as G,h as v,D as y,E as C,o as l,c as V,w as N,b as o,f as i,i as _,B as h,G as w,d,t as r,F as B,a as D}from"./app-Bm5g5IQi.js";import{L as q,u as E}from"./Index-BfhsCJ__.js";import{u as M}from"./index-D8ehHb0j.js";import{u as U}from"./vue-router-BKYXVPYG.js";import{_ as F}from"./_plugin-vue_export-helper-DlAUqK2U.js";/* empty css            */const L={name:"Transaction",components:{Layout:q},setup(){const c=E(),s=f(null),u=f(""),t=M(),k=U(),m=15e3,p=0,g=f("");G(()=>{S()});const n=v(()=>c.cart);c.loadDiscount();const S=async()=>{const a=localStorage.getItem("authToken");if(a){y.defaults.headers.common.Authorization=`Bearer ${a}`;try{const e=await y.get("/api/user");e.data.status?s.value=e.data:u.value=e.data.message}catch(e){console.error("Error fetching user:",e),u.value="Đã xảy ra lỗi trong quá trình lấy thông tin người dùng."}}else u.value="Bạn chưa đăng nhập."},T=a=>new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND"}).format(a),x=v(()=>n.value.reduce((a,e)=>a+e.price*e.quantity,0)),b=v(()=>x.value+m-p);return{user:s,cart:n,formatCurrency:T,cartSubtotal:x,shippingFee:m,discount:p,total:b,placeOrder:async()=>{try{const a=await y.post("/api/orders",{items:n.value.map(e=>({product_id:e.id,total_item:e.quantity,total_price:e.price*e.quantity})),total_price:b.value,transport_fee:m,discount_id:c.discount?c.discount.id:null,note:g.value,name:s.value.name,email:s.value.email,phone:s.value.phone,address:s.value.address});a.data.status?(t.success("Đơn hàng của bạn đã được đặt thành công!"),c.clearCart(),c.clearDiscount(),k.push({name:"Menu"})):t.error(a.data.message||"Đã xảy ra lỗi khi đặt hàng.")}catch(a){console.error("Error placing order:",a),t.error("Đã xảy ra lỗi khi đặt hàng.")}},errorMessage:u,cartStore:c,note:g}}},I={class:"container margin_60_40"},O={class:"row justify-content-center"},H={class:"col-xl-6 col-lg-8"},P={class:"box_booking_2 style_2"},R=o("div",{class:"head"},[o("div",{class:"title"},[o("h3",null,"Thông tin cá nhân")])],-1),j={class:"main"},z={key:0},A={class:"form-group"},Q=o("label",null,"Họ và tên",-1),J={class:"row"},K={class:"col-md-6"},W={class:"form-group"},X=o("label",null,"Email",-1),Y={class:"col-md-6"},Z={class:"form-group"},$=o("label",null,"Số điện thoại",-1),oo={class:"form-group"},to=o("label",null,"Địa chỉ",-1),no={key:1},so=o("p",null,"THÔNG TIN NGƯỜI DÙNG TRỐNG",-1),eo=[so],ao={class:"form-group"},ro=o("label",null,"Ghi chú",-1),lo={class:"col-xl-4 col-lg-4",id:"sidebar_fixed"},co={class:"box_booking"},io=o("div",{class:"head"},[o("h3",null,"Tóm tắt hoá đơn")],-1),uo={class:"main"},_o={class:"clearfix"},ho={class:"clearfix"},mo={key:0},po={key:0},go={key:1},fo={key:1},vo={class:"total"},yo={class:"text-center"},ko=o("strong",null,"Giỏ hàng",-1);function xo(c,s,u,t,k,m){const p=C("router-link"),g=C("Layout");return l(),V(g,null,{content:N(()=>[o("div",I,[o("div",O,[o("div",H,[o("div",P,[R,o("div",j,[t.user?(l(),i("div",z,[o("div",A,[Q,_(o("input",{"onUpdate:modelValue":s[0]||(s[0]=n=>t.user.name=n),class:"form-control",placeholder:"Họ và tên"},null,512),[[h,t.user.name]])]),o("div",J,[o("div",K,[o("div",W,[X,_(o("input",{"onUpdate:modelValue":s[1]||(s[1]=n=>t.user.email=n),class:"form-control",placeholder:"Địa chỉ Email"},null,512),[[h,t.user.email]])])]),o("div",Y,[o("div",Z,[$,_(o("input",{"onUpdate:modelValue":s[2]||(s[2]=n=>t.user.phone=n),class:"form-control",placeholder:"Số điện thoại"},null,512),[[h,t.user.phone]])])])]),o("div",oo,[to,_(o("input",{"onUpdate:modelValue":s[3]||(s[3]=n=>t.user.address=n),class:"form-control",placeholder:"Địa chỉ"},null,512),[[h,t.user.address]])])])):(l(),i("div",no,eo)),o("div",ao,[ro,_(o("textarea",{"onUpdate:modelValue":s[4]||(s[4]=n=>t.note=n),class:"form-control",placeholder:"Ghi chú"},null,512),[[h,t.note]])])])])]),o("div",lo,[o("div",co,[io,o("div",uo,[o("ul",_o,[(l(!0),i(B,null,w(t.cart,n=>(l(),i("li",{key:n.id},[d(r(n.name)+" x "+r(n.quantity)+" ",1),o("span",null,r(t.formatCurrency(n.price*n.quantity)),1)]))),128))]),o("ul",ho,[o("li",null,[d(" Tổng phụ"),o("span",null,r(t.formatCurrency(t.cartSubtotal)),1)]),o("li",null,[d(" Phí giao hàng"),o("span",null,r(t.formatCurrency(t.shippingFee)),1)]),t.cartStore.discount?(l(),i("li",mo,[d(" Mã giảm giá: "+r(t.cartStore.discount.name)+" ",1),t.cartStore.discount.condition===1?(l(),i("span",po," -"+r(t.formatCurrency(t.cartStore.discount.number)),1)):(l(),i("span",go," -"+r(t.cartStore.discount.number)+"% ",1))])):(l(),i("li",fo,[d(" Mã giảm giá"),o("span",null,r(t.formatCurrency(t.discount)),1)])),o("li",vo,[d(" TỔNG CỘNG"),o("span",null,r(t.formatCurrency(t.total)),1)])]),o("a",{onClick:s[5]||(s[5]=(...n)=>t.placeOrder&&t.placeOrder(...n)),class:"btn_1 full-width mb_5"},"Đặt hàng ngay"),o("div",yo,[o("small",null,[d(" Quay lại giỏ hàng "),D(p,{to:{name:"Cart"}},{default:N(()=>[ko]),_:1})])])])])])])])]),_:1})}const wo=F(L,[["render",xo]]);export{wo as default};
